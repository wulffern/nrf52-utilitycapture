#!/usr/bin/perl
######################################################################
##        Copyright (c) 2017 Carsten Wulff Software, Norway
## ###################################################################
## Created       : wulff at 2017-10-8
## ###################################################################
##   This program is free software: you can redistribute it and/or modify
##   it under the terms of the GNU General Public License as published by
##   the Free Software Foundation, either version 3 of the License, or
##   (at your option) any later version.
##
##   This program is distributed in the hope that it will be useful,
##   but WITHOUT ANY WARRANTY; without even the implied warranty of
##   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
##   GNU General Public License for more details.
##
##   You should have received a copy of the GNU General Public License
##   along with this program.  If not, see <http://www.gnu.org/licenses/>.
######################################################################

use FindBin;


#- Functions
sub readFile;
sub getIndexes;
use Time::Local;

#- Arguments
my $dir = "/Users/wulff/Dropbox/utility/pilogs";
my $datafile = shift;

my %data;
my $d = \%data;

#- Sync files
my $cmd = "cd $dir".' ;ssh pi@pi "cd /home/pi/data/utility/pilogs; tar cfz - ." | tar zxf - ';

print $cmd."\n";
system($cmd);
my @files = `ls -1tr $dir`;
#- Read names
foreach my $f (@files) {
  chomp($f);
  next unless $f =~ m/\d+-\d+-\d+\.dat$/;
  push(@dfiles,$dir."/".$f);
  
}

#- Read files
for (my $i=0; $i< scalar(@dfiles);$i+=1) {
  my $f = $dfiles[$i];
  system("cd $FindBin::Bin"."/../matlab; /usr/local/octave/3.8.0/bin/octave -fq script_plotday.m $f");
  my $p = $f.".pdf";
  my $pn = $p;
  $pn =~ s/pilogs/piplots/ig;
  system("mv $p $pn");
}



